"use strict";(self.webpackChunkimagery_explorer_apps=self.webpackChunkimagery_explorer_apps||[]).push([[7503],{47503:function(e,t,r){r.r(t),r.d(t,{default:function(){return te}});var n=r(36663),i=r(66341),o=r(41151),a=r(6865),l=r(70375),s=r(15842),u=r(78668),c=r(3466),d=r(81977),p=(r(39994),r(13802)),y=(r(4157),r(40266)),m=r(38481),f=r(23148),h=r(55854),b=r(86114),g=r(27668),v=r(95874),_=r(51599),T=r(92557),I=r(94451),C=r(93968),F=r(53110),x=r(76432);class V{constructor(e,t){this.objectId=e,this.itemSource=t,this.count=0,this.layer=null,this.sortValue=void 0}}const w=new h.z(20,(e=>e.destroy()));let S=class extends((0,v.M)((0,g.h)((0,s.R)(m.Z)))){constructor(e){super(e),this._oidToReference=new Map,this._layerToReference=new Map,this._portals=new Map,this.layers=new a.Z,this.maximumVisibleSublayers=10,this.opacity=1,this.title="Layers In View",this.type="catalog-dynamic-group",this.visible=!0}load(e){return this.addResolvingPromise(this.parent.load()),Promise.resolve(this)}get _orderBy(){return this.parent.orderBy?.find((e=>!e.valueExpression&&e.field))??new I.Z({field:this.parent.objectIdField})}get _referenceComparator(){const e=this._orderBy,t=this.parent.fieldsIndex.get(e.field),r=(0,x.Lq)(t?.toJSON().type,"descending"===e.order);return(e,t)=>r(e.sortValue,t.sortValue)||e.objectId-e.objectId}acquireLayer(e){const t=e.getObjectId(),r=(0,b.s1)(this._oidToReference,t,(()=>this._createLayerReference(e)));return r.count++,(0,f.kB)((()=>{r.count--,r.count||this._disposeLayerReference(r)}))}_createLayerReference(e){const t=e.getObjectId(),r=e.getAttribute(this.parent.itemSourceField),n=new V(t,r);if(w.get(r))return this._addLayer(w.pop(r),n,e),n;let i;try{i=JSON.parse(r)}catch(e){return p.Z.getLogger(this).error(e),n}return this._createLayer(i).then((t=>{this.destroyed||0===n.count?(w.get(r)||w.put(n.itemSource,t),n.layer=null):this._addLayer(t,n,e)})).catch((()=>{})),n}_addLayer(e,t,r){this._layerToReference.set(e,t),t.sortValue=r.getAttribute(this._orderBy.field),t.layer=e,e.parent=this,this.layers.add(e),this.layers.sort(((e,t)=>this._referenceComparator(this._layerToReference.get(e),this._layerToReference.get(t))))}_disposeLayerReference(e){e.layer&&(this._layerToReference.delete(e.layer),this.layers.remove(e.layer),w.put(e.itemSource,e.layer)),this._oidToReference.delete(e.objectId)}async _createLayer(e){if(!function(e){return"object"==typeof e&&null!=e&&"itemId"in e&&"portalUrl"in e}(e))return new(await T.T.UnsupportedLayer());const{itemId:t,portalUrl:r}=e,n=(0,b.s1)(this._portals,r,(()=>new C.Z({url:r})));return m.Z.fromPortalItem(new F.default({id:t,portal:n}))}};(0,n._)([(0,d.Cb)()],S.prototype,"_orderBy",null),(0,n._)([(0,d.Cb)()],S.prototype,"_referenceComparator",null),(0,n._)([(0,d.Cb)({readOnly:!0})],S.prototype,"layers",void 0),(0,n._)([(0,d.Cb)()],S.prototype,"maximumVisibleSublayers",void 0),(0,n._)([(0,d.Cb)(_.Oh)],S.prototype,"opacity",void 0),(0,n._)([(0,d.Cb)({type:String,json:{name:"title",write:!0}})],S.prototype,"title",void 0),(0,n._)([(0,d.Cb)({json:{read:!1}})],S.prototype,"type",void 0),(0,n._)([(0,d.Cb)({type:Boolean,json:{name:"visibility",write:!0}})],S.prototype,"visible",void 0),S=(0,n._)([(0,y.j)("esri.layers.catalog.CatalogDynamicGroupLayer")],S);const L=S;var D=r(80020),j=(r(86004),r(55565),r(16192),r(71297),r(878),r(22836),r(50172),r(72043),r(72506),r(54021)),z=r(22368),N=r(26732),O=r(49341),P=r(10171);let q=class extends((0,v.M)((0,z.b)((0,g.h)((0,s.R)(m.Z))))){constructor(e){super(e),this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.opacity=1,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.type="catalog-footprint",this.visible=!0}load(e){return this.addResolvingPromise(this.parent.load()),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}get fields(){return this.parent.fields}get fieldsIndex(){return this.parent.fieldsIndex}get geometryType(){return this.parent.geometryType}get objectIdField(){return this.parent.objectIdField}get orderBy(){return this.parent.orderBy}createPopupTemplate(e){const t={fields:this.parent.fields,objectIdField:this.parent.objectIdField,title:this.title};return(0,P.eZ)(t,e)}createQuery(){return this.parent.createQuery()}queryFeatures(e,t){return this.parent.queryFeatures(e,t)}};(0,n._)([(0,d.Cb)({readOnly:!0})],q.prototype,"defaultPopupTemplate",null),(0,n._)([(0,d.Cb)({type:[N.Z],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:O.r,write:!0}})],q.prototype,"labelingInfo",void 0),(0,n._)([(0,d.Cb)(_.iR)],q.prototype,"labelsVisible",void 0),(0,n._)([(0,d.Cb)(_.rn)],q.prototype,"legendEnabled",void 0),(0,n._)([(0,d.Cb)(_.Oh)],q.prototype,"opacity",void 0),(0,n._)([(0,d.Cb)(_.C_)],q.prototype,"popupEnabled",void 0),(0,n._)([(0,d.Cb)({type:D.Z,json:{name:"popupInfo",write:!0}})],q.prototype,"popupTemplate",void 0),(0,n._)([(0,d.Cb)({types:j.A,json:{name:"layerDefinition.drawingInfo.renderer"}})],q.prototype,"renderer",void 0),(0,n._)([(0,d.Cb)({json:{read:!1}})],q.prototype,"type",void 0),(0,n._)([(0,d.Cb)({type:Boolean,json:{name:"visibility",write:!0}})],q.prototype,"visible",void 0),q=(0,n._)([(0,y.j)("esri.layers.catalog.CatalogFootprintLayer")],q);const R=q;var Z=r(87676),k=r(40400),E=r(91223),M=r(87232),B=r(63989),Q=r(3465),U=r(43330),G=r(91610),$=r(18241),A=r(12478),J=r(2030),Y=r(23556),H=r(89076),K=r(76912),X=r(14136);const W=(0,H.v)();let ee=class extends((0,Q.B)((0,g.h)((0,G.c)((0,J.n)((0,v.M)((0,A.Q)((0,M.Y)((0,U.q)((0,$.I)((0,s.R)((0,B.N)((0,E.V)((0,o.J)(m.Z)))))))))))))){constructor(e){super(e),this.dynamicGroupLayer=new L({parent:this}),this.fields=null,this.fieldsIndex=null,this.footprintLayer=new R({parent:this}),this.itemSourceField="cd_itemsource",this.itemTypeField="cd_itemtype",this.layers=new a.Z([this.dynamicGroupLayer,this.footprintLayer]),this.source=new Z.default({layer:this}),this.type="catalog"}load(e){const t=null!=e?e.signal:null,r=this.loadFromPortal({supportedTypes:["Feature Service"]},e).catch(u.r9).then((async()=>{if(!this.url)throw new l.Z("catalog-layer:missing-url","Catalog layer must be created with a url");if(this.url&&null==this.layerId){const e=await this._fetchFirstValidLayerId(t);if(null==e)throw new l.Z("catalog-layer:missing-layerId","There is no Catalog Layer in the service",{service:this.url});this.layerId=e}await this.source.load(),this.source.sourceJSON&&(this.sourceJSON=this.source.sourceJSON,this.read(this.source.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}))})).then((()=>(0,Y.nU)(this,"load",e)));return this.addResolvingPromise(r),Promise.resolve(this)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")??0)+1}get parsedUrl(){const e=(0,c.mN)(this.url);return null!=e&&null!=this.layerId&&(e.path=(0,c.v_)(e.path,this.layerId.toString())),e}createQuery(){const e=new X.Z,t=this.capabilities?.query;e.returnGeometry=!0,t&&(e.compactGeometryEnabled=t.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=t.supportsDefaultSpatialReference),e.outFields=["*"];const{timeOffset:r,timeExtent:n}=this;return e.timeExtent=null!=r&&null!=n?n.offset(-r.value,r.unit):n||null,e}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return this.fieldsIndex.get(e)?.domain}async queryFeatures(e,t){const r=await this.load(),n=await r.source.queryFeatures(X.Z.from(e)??r.createQuery(),t);if(n?.features)for(const e of n.features)e.layer=e.sourceLayer=r.footprintLayer;return n}async queryObjectIds(e,t){return(await this.load()).source.queryObjectIds(X.Z.from(e)??this.createQuery(),t)}async queryFeatureCount(e,t){return(await this.load()).source.queryFeatureCount(X.Z.from(e)??this.createQuery(),t)}async queryExtent(e,t){return(await this.load()).source.queryExtent(X.Z.from(e)??this.createQuery(),t)}serviceSupportsSpatialReference(e){return this.loaded&&(0,K.D)(this,e)}read(e,t){super.read(e,t);let r=e.footprintLayer;r||"service"!==t?.origin||(r={layerDefinition:{drawingInfo:(0,k.bU)(e.geometryType)}}),this.footprintLayer.read(r,t)}_fetchFirstValidLayerId(e){return(0,i.Z)(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then((e=>{const t=e.data;if(t)return Array.isArray(t.layers)?t.layers.find((e=>"Catalog Layer"===e.type))?.id:void 0}))}};(0,n._)([(0,d.Cb)({readOnly:!0})],ee.prototype,"createQueryVersion",null),(0,n._)([(0,d.Cb)({...W.fields,json:{origins:{service:{name:"fields"}}}})],ee.prototype,"fields",void 0),(0,n._)([(0,d.Cb)(W.fieldsIndex)],ee.prototype,"fieldsIndex",void 0),(0,n._)([(0,d.Cb)({json:{read:!1,write:!1}})],ee.prototype,"footprintLayer",void 0),(0,n._)([(0,d.Cb)()],ee.prototype,"itemSourceField",void 0),(0,n._)([(0,d.Cb)()],ee.prototype,"itemTypeField",void 0),(0,n._)([(0,d.Cb)()],ee.prototype,"layers",void 0),(0,n._)([(0,d.Cb)({value:"CatalogLayer",type:["CatalogLayer"]})],ee.prototype,"operationalLayerType",void 0),(0,n._)([(0,d.Cb)()],ee.prototype,"outFields",void 0),(0,n._)([(0,d.Cb)({readOnly:!0})],ee.prototype,"parsedUrl",null),(0,n._)([(0,d.Cb)()],ee.prototype,"source",void 0),(0,n._)([(0,d.Cb)({json:{read:!1}})],ee.prototype,"type",void 0),ee=(0,n._)([(0,y.j)("esri.layers.CatalogLayer")],ee);const te=ee},76432:function(e,t,r){r.d(t,{DL:function(){return Z},F_:function(){return j},G2:function(){return q},H0:function(){return h},Lq:function(){return v},Qm:function(){return O},S5:function(){return f},XL:function(){return g},eT:function(){return z},fk:function(){return P},i5:function(){return b},oF:function(){return k},wk:function(){return m}});var n=r(82392),i=r(22595);const o="<Null>",a="equal-interval",l=1,s=5,u=10,c=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,d=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),p=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),y=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function m(e){return null==e||"string"==typeof e&&!e?o:e}function f(e){const t=null!=e.normalizationField||null!=e.normalizationType,r=null!=e.minValue||null!=e.maxValue,n=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!r&&!n}function h(e){const t=e.returnDistinct?[...new Set(e.values)]:e.values,r=t.filter((e=>null!=e)).sort(),n=r.length,i={count:n,min:r[0],max:r[n-1]};return e.supportsNullCount&&(i.nullcount=t.length-n),e.percentileParams&&(i.median=g(t,e.percentileParams)),i}function b(e){const{values:t,useSampleStdDev:r,supportsNullCount:n}=e;let i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=null,l=null,s=null,u=null,c=0;const d=null==e.minValue?-1/0:e.minValue,p=null==e.maxValue?1/0:e.maxValue;for(const e of t)Number.isFinite(e)?e>=d&&e<=p&&(a=null===a?e:a+e,i=Math.min(i,e),o=Math.max(o,e),c++):"string"==typeof e&&c++;if(c&&null!=a){l=a/c;let e=0;for(const r of t)Number.isFinite(r)&&r>=d&&r<=p&&(e+=(r-l)**2);u=r?c>1?e/(c-1):0:c>0?e/c:0,s=Math.sqrt(u)}else i=null,o=null;const y={avg:l,count:c,max:o,min:i,stddev:s,sum:a,variance:u};return n&&(y.nullcount=t.length-c),e.percentileParams&&(y.median=g(t,e.percentileParams)),y}function g(e,t){const{fieldType:r,value:n,orderBy:i,isDiscrete:o}=t,a=v(r,"desc"===i);if(0===(e=[...e].filter((e=>null!=e)).sort(((e,t)=>a(e,t)))).length)return null;if(n<=0)return e[0];if(n>=1)return e[e.length-1];const l=(e.length-1)*n,s=Math.floor(l),u=s+1,c=l%1,d=e[s],p=e[u];return u>=e.length||o||"string"==typeof d||"string"==typeof p?d:d*(1-c)+p*c}function v(e,t){if(e){if(d.has(e))return L(t);if(p.has(e))return V(t,!1);if("esriFieldTypeTimestampOffset"===e)return function(e){return e?C:I}(t);const r=V(t,!0);if("esriFieldTypeString"===e)return r;if("esriFieldTypeGUID"===e||"esriFieldTypeGlobalID"===e)return(e,t)=>r(D(e),D(t))}const r=t?1:-1,n=L(t),i=V(t,!0);return(e,t)=>"number"==typeof e&&"number"==typeof t?n(e,t):"string"==typeof e&&"string"==typeof t?i(e,t):r}const _=(e,t)=>null==e?null==t?0:1:null==t?-1:null,T=(e,t)=>null==e?null==t?0:-1:null==t?1:null;const I=(e,t)=>T(e,t)??(e===t?0:new Date(e).getTime()-new Date(t).getTime()),C=(e,t)=>_(e,t)??(e===t?0:new Date(t).getTime()-new Date(e).getTime());const F=(e,t)=>T(e,t)??(e===t?0:e<t?-1:1),x=(e,t)=>_(e,t)??(e===t?0:e<t?1:-1);function V(e,t){if(!t)return e?x:F;const r=function(e){return e?_:T}(e);return e?(e,t)=>{const n=r(e,t);return null!=n?n:(e=e.toUpperCase())>(t=t.toUpperCase())?-1:e<t?1:0}:(e,t)=>{const n=r(e,t);return null!=n?n:(e=e.toUpperCase())<(t=t.toUpperCase())?-1:e>t?1:0}}const w=(e,t)=>_(e,t)??t-e,S=(e,t)=>T(e,t)??e-t;function L(e){return e?w:S}function D(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function j(e,t){let r;for(r in e)y.includes(r)&&(Number.isFinite(e[r])||(e[r]=null));return t?(["avg","stddev","variance"].forEach((t=>{null!=e[t]&&(e[t]=Math.ceil(e[t]??0))})),e):e}function z(e){const t={};for(let r of e)(null==r||"string"==typeof r&&""===r.trim())&&(r=null),null==t[r]?t[r]={count:1,data:r}:t[r].count++;return{count:t}}function N(e){return"coded-value"!==e?.type?[]:e.codedValues.map((e=>e.code))}function O(e,t,r,n){const i=e.count,o=[];if(r&&t){const e=[],r=N(t[0]);for(const i of r)if(t[1]){const r=N(t[1]);for(const o of r)if(t[2]){const r=N(t[2]);for(const t of r)e.push(`${m(i)}${n}${m(o)}${n}${m(t)}`)}else e.push(`${m(i)}${n}${m(o)}`)}else e.push(i);for(const t of e)i.hasOwnProperty(t)||(i[t]={data:t,count:0})}for(const e in i){const t=i[e];o.push({value:t.data,count:t.count,label:t.label})}return{uniqueValueInfos:o}}function P(e,t,r,n){let i=null;switch(t){case"log":0!==e&&(i=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(n)&&0!==n&&(i=e/n*100);break;case"field":Number.isFinite(r)&&0!==r&&(i=e/r);break;case"natural-log":e>0&&(i=Math.log(e));break;case"square-root":e>0&&(i=e**.5)}return i}function q(e,t){const r=R({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||s});return e=function(e,t,r){const n=t??-1/0,i=r??1/0;return e.filter((e=>Number.isFinite(e)&&e>=n&&e<=i))}(e,t.minValue,t.maxValue),(0,i.k)({definition:r,values:e,normalizationTotal:t.normalizationTotal})}function R(e){const{breakCount:t,field:r,normalizationField:i,normalizationType:o}=e,s=e.classificationMethod||a,u="standard-deviation"===s?e.standardDeviationInterval||l:void 0;return new n.Z({breakCount:t,classificationField:r,classificationMethod:s,normalizationField:"field"===o?i:void 0,normalizationType:o,standardDeviationInterval:u})}function Z(e,t){let r=e.classBreaks;const n=r.length,i=r[0]?.minValue,o=r[n-1]?.maxValue,a="standard-deviation"===t,l=c;return r=r.map((e=>{const t=e.label,r={minValue:e.minValue,maxValue:e.maxValue,label:t};if(a&&t){const e=t.match(l),n=e?.map((e=>+e.trim()))??[];2===n.length?(r.minStdDev=n[0],r.maxStdDev=n[1],n[0]<0&&n[1]>0&&(r.hasAvg=!0)):1===n.length&&(t.includes("<")?(r.minStdDev=null,r.maxStdDev=n[0]):t.includes(">")&&(r.minStdDev=n[0],r.maxStdDev=null))}return r})),{minValue:i,maxValue:o,classBreakInfos:r,normalizationTotal:e.normalizationTotal}}function k(e,t){const r=E(e,t);if(null==r.min&&null==r.max)return{bins:[],minValue:r.min,maxValue:r.max,normalizationTotal:t.normalizationTotal};const n=r.intervals,i=r.min??0,o=r.max??0,a=n.map(((e,t)=>({minValue:n[t][0],maxValue:n[t][1],count:0})));for(const t of e)if(null!=t&&t>=i&&t<=o){const e=M(n,t);e>-1&&a[e].count++}return{bins:a,minValue:i,maxValue:o,normalizationTotal:t.normalizationTotal}}function E(e,t){const{field:r,classificationMethod:n,standardDeviationInterval:i,normalizationType:o,normalizationField:a,normalizationTotal:l,minValue:s,maxValue:c}=t,d=t.numBins||u;let p=null,y=null,m=null;if(n&&"equal-interval"!==n||o){const{classBreaks:t}=q(e,{field:r,normalizationType:o,normalizationField:a,normalizationTotal:l,classificationMethod:n,standardDeviationInterval:i,minValue:s,maxValue:c,numClasses:d});p=t[0].minValue,y=t[t.length-1].maxValue,m=t.map((e=>[e.minValue,e.maxValue]))}else{if(null!=s&&null!=c)p=s,y=c;else{const t=b({values:e,minValue:s,maxValue:c,useSampleStdDev:!o,supportsNullCount:f({normalizationType:o,normalizationField:a,minValue:s,maxValue:c})});p=t.min??null,y=t.max??null}m=function(e,t,r){const n=(t-e)/r,i=[];let o,a=e;for(let e=1;e<=r;e++)o=a+n,o=Number(o.toFixed(16)),i.push([a,e===r?t:o]),a=o;return i}(p??0,y??0,d)}return{min:p,max:y,intervals:m}}function M(e,t){let r=-1;for(let n=e.length-1;n>=0;n--)if(t>=e[n][0]){r=n;break}return r}}}]);