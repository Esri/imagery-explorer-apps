"use strict";(self.webpackChunkimagery_explorer_apps=self.webpackChunkimagery_explorer_apps||[]).push([[4372],{14372:function(e,t,i){i.r(t),i.d(t,{default:function(){return v}});var s=i(36663),r=i(80085),n=i(7753),a=i(6865),h=i(23148),o=i(61681),l=i(81977),c=(i(39994),i(13802),i(40266)),u=i(26991),d=i(66878),g=i(68114),p=i(18133),_=i(91792),f=i(26216);let m=class extends((0,d.y)(f.Z)){constructor(){super(...arguments),this._highlightCounter=new _.i}attach(){this.graphicsView=new p.Z({requestUpdateCallback:()=>this.requestUpdate(),view:this.view,graphics:this.layer.graphics,container:new g.Z(this.view.featuresTilingScheme),layerId:this.layer.id}),this.container.addChild(this.graphicsView.container),this.addAttachHandles(this.layer.on("graphic-update",this.graphicsView.graphicUpdateHandler)),this._updateHighlight()}detach(){this.container.removeAllChildren(),this.graphicsView=(0,o.SC)(this.graphicsView)}async hitTest(e){return this.graphicsView?this.graphicsView.hitTest(e).map((t=>({type:"graphic",graphic:t,mapPoint:e,layer:this.layer}))):null}queryGraphics(){return Promise.resolve(this.graphicsView.graphics)}update(e){this.graphicsView.processUpdate(e)}moveStart(){}viewChange(){this.graphicsView.viewChange()}moveEnd(){}isUpdating(){return!this.graphicsView||this.graphicsView.updating}highlight(e,t="highlight"){let i;"number"==typeof e?i=[e]:e instanceof r.Z?i=[e.uid]:Array.isArray(e)&&e.length>0?i="number"==typeof e[0]?e:e.map((e=>e&&e.uid)):a.Z.isCollection(e)&&e.length>0&&(i=e.map((e=>e&&e.uid)).toArray());const s=i?.filter(n.pC);return s?.length?(this._addHighlight(s,t),(0,h.kB)((()=>this._removeHighlight(s,t)))):(0,h.kB)()}_addHighlight(e,t){this._highlightCounter.addReason(e,t),this._updateHighlight()}_removeHighlight(e,t){this._highlightCounter.deleteReason(e,t),this._updateHighlight()}_updateHighlight(){const e=[];for(const t of this._highlightCounter.ids()){const i=this._highlightCounter.getHighestReason(t),s=(0,u.ck)(i);e.push({objectId:t,highlightFlags:s})}this.graphicsView?.setHighlight(e)}};(0,s._)([(0,l.Cb)()],m.prototype,"graphicsView",void 0),m=(0,s._)([(0,c.j)("esri.views.2d.layers.GraphicsLayerView2D")],m);const v=m},81110:function(e,t,i){i.d(t,{K:function(){return S}});var s=i(61681),r=i(24778),n=i(38716),a=i(16699),h=i(56144),o=i(77206);let l=0;function c(e,t,i){return new a.o((0,o.W)(l++),e,e.meshWriter.name,t,i)}const u={geometry:{visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null}};class d{constructor(){this.instances={fill:c(h.k2.fill,u,{zoomRange:!0}),marker:c(h.k2.marker,u,{zoomRange:!0}),line:c(h.k2.line,u,{zoomRange:!0}),text:c(h.k2.text,u,{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}),complexFill:c(h.k2.complexFill,u,{zoomRange:!0}),texturedLine:c(h.k2.texturedLine,u,{zoomRange:!0})},this._instancesById=Object.values(this.instances).reduce(((e,t)=>(e.set(t.instanceId,t),e)),new Map)}getInstance(e){return this._instancesById.get(e)}}var g=i(46332),p=i(38642),_=i(45867),f=i(17703),m=i(29927),v=i(51118),y=i(64429),w=i(78951),b=i(91907),x=i(29620);const C=Math.PI/180;class R extends v.s{constructor(e){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,p.Ue)(),this._localOrigin={x:0,y:0},this._getBounds=e}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,s.M2)(this._program)}doRender(e){const{context:t}=e,i=this._getBounds();if(i.length<1)return;this._createShaderProgram(t),this._updateMatricesAndLocalOrigin(e),this._updateBufferData(t,i),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!1),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1),t.setBlendFunction(b.zi.ONE,b.zi.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0);const s=this._program;t.bindVAO(this._vao),t.useProgram(s),s.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),t.gl.lineWidth(1),t.drawElements(b.MX.LINES,8*i.length,b.g.UNSIGNED_INT,0),t.bindVAO()}_createTransforms(){return{displayViewScreenMat3:(0,p.Ue)()}}_createShaderProgram(e){if(this._program)return;this._program=e.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",V().attributes)}_updateMatricesAndLocalOrigin(e){const{state:t}=e,{displayMat3:i,size:s,resolution:r,pixelRatio:n,rotation:a,viewpoint:h}=t,o=C*a,{x:l,y:c}=h.targetGeometry,u=(0,m.or)(l,t.spatialReference);this._localOrigin.x=u,this._localOrigin.y=c;const d=n*s[0],p=n*s[1],v=r*d,y=r*p,w=(0,g.yR)(this._dvsMat3);(0,g.Jp)(w,w,i),(0,g.Iu)(w,w,(0,_.al)(d/2,p/2)),(0,g.bA)(w,w,(0,f.al)(s[0]/v,-p/y,1)),(0,g.U1)(w,w,-o)}_updateBufferData(e,t){const{x:i,y:s}=this._localOrigin,r=8*t.length,n=new Float32Array(r),a=new Uint32Array(8*t.length);let h=0,o=0;for(const e of t)e&&(n[2*h]=e[0]-i,n[2*h+1]=e[1]-s,n[2*h+2]=e[0]-i,n[2*h+3]=e[3]-s,n[2*h+4]=e[2]-i,n[2*h+5]=e[3]-s,n[2*h+6]=e[2]-i,n[2*h+7]=e[1]-s,a[o]=h+0,a[o+1]=h+3,a[o+2]=h+3,a[o+3]=h+2,a[o+4]=h+2,a[o+5]=h+1,a[o+6]=h+1,a[o+7]=h+0,h+=4,o+=8);if(this._vertexBuffer?this._vertexBuffer.setData(n.buffer):this._vertexBuffer=w.f.createVertex(e,b.l1.DYNAMIC_DRAW,n.buffer),this._indexBuffer?this._indexBuffer.setData(a):this._indexBuffer=w.f.createIndex(e,b.l1.DYNAMIC_DRAW,a),!this._vao){const t=V();this._vao=new x.U(e,t.attributes,t.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const V=()=>(0,y.cM)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:b.g.FLOAT}]});class S extends r.b{constructor(e){super(e),this._instanceStore=new d,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,s.SC)(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(e){this._boundsRenderer=new R(e),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(e,t){e.onMessage(t),this.contains(e)||this.addChild(e),this.requestRender()}_renderChildren(e,t){e.selection=t;for(const t of this.children){if(!t.visible)continue;const i=t.getDisplayList(e.drawPhase,this._instanceStore,n.gl.STRICT_ORDER);i?.render(e)}}}},68114:function(e,t,i){i.d(t,{Z:function(){return a}});var s=i(38716),r=i(81110),n=i(41214);class a extends r.K{renderChildren(e){for(const t of this.children)t.setTransform(e.state);if(super.renderChildren(e),this.attributeView.update(),this.children.some((e=>e.hasData))){switch(e.drawPhase){case s.jx.MAP:this._renderChildren(e,s.Xq.All);break;case s.jx.HIGHLIGHT:this.hasHighlight&&this._renderHighlight(e)}this._boundsRenderer&&this._boundsRenderer.doRender(e)}}_renderHighlight(e){(0,n.P9)(e,!1,(e=>{this._renderChildren(e,s.Xq.Highlight)}))}}}}]);